{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Support Center</h3>
                </div>
                <div class="card-body">
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- Support Ticket Form -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5>Submit a Support Ticket</h5>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{{ url_for('submit_ticket') }}">
                                <div class="mb-3">
                                    <label for="issue_type" class="form-label">Issue Type</label>
                                    <select class="form-select" id="issue_type" name="issue_type" required>
                                        <option value="" disabled selected>Select issue type</option>
                                        <option value="book_issue">Book Issue</option>
                                        <option value="account">Account Problem</option>
                                        <option value="technical">Technical Problem</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    <textarea class="form-control" id="description" name="description" rows="5" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Submit Ticket</button>
                            </form>
                        </div>
                    </div>

                    <!-- Existing Tickets (if any) -->
                    {% if tickets %}
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5>Your Support Tickets</h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                {% for ticket in tickets %}
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">{{ ticket.issue_type|replace('_', ' ')|title }}</h6>
                                        <small class="text-{% if ticket.status == 'open' %}warning{% else %}success{% endif %}">
                                            {{ ticket.status|title }}
                                        </small>
                                    </div>
                                    <p class="mb-1">{{ ticket.description }}</p>
                                    <small>Submitted on {{ ticket.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                                    {% if ticket.resolution %}
                                    <div class="mt-2 p-2 bg-light rounded">
                                        <strong>Resolution:</strong> {{ ticket.resolution }}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Support Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5><i class="bi bi-info-circle-fill text-primary me-2"></i>Support Options</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h6><i class="bi bi-envelope-fill text-primary me-2"></i>Email Support</h6>
                                            <p class="mb-1">support@librarysystem.com</p>
                                            <small class="text-muted">Typically responds within 24 hours</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h6><i class="bi bi-telephone-fill text-primary me-2"></i>Phone Support</h6>
                                            <p class="mb-1">+91 9100000001</p>
                                            <small class="text-muted">Mon-Fri, 9am-5pm</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FAQ Section -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5><i class="bi bi-question-circle-fill text-primary me-2"></i>Frequently Asked Questions</h5>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="faqAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" 
                                                data-bs-toggle="collapse" data-bs-target="#faq1">
                                            How long does it take to get a response to my ticket?
                                        </button>
                                    </h2>
                                    <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            We typically respond to support tickets within 24 hours during business days.
                                            For urgent issues, please use our phone support.
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" 
                                                data-bs-toggle="collapse" data-bs-target="#faq2">
                                            Can I check the status of my submitted ticket?
                                        </button>
                                    </h2>
                                    <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            Yes, once you submit a ticket, you'll receive a confirmation email with a ticket number.
                                            You can reply to that email thread for updates or check your account dashboard.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}